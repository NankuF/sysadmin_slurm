# Общий алгоритм обеспечения безопасности

Итого к выполнению:
1) Используем минимальный образ ОС для ограничения поверхности атаки
2) Отключаем неиспользуемые службы
3) Отключаем неиспользуемые модули ядра
4) Настраиваем фильтрацию и блокировку трафика - firewall через iptables/nftables/ufw/firewalld, попутно закрывая порты
5) Удаляем неиспользуемые пакеты
6) Регулярно обновляем систему (обновляется ПО и ядро)
6.1) Подключить автообновление системы безопасности unattended-upgrades
7) Отслеживаем уязвимости с помощью trivy и патчим систему.
8) Настраиваем fail2ban для предотвращения брутфорса SSH
9) Настраиваем history - размер, запрет на удаление, сбор логов по history в центральное хранилище логов
10) Настраиваем auditd для контроля за действиями пользователей
11) Для всего нового ПО настраиваем профили в AppArmor (защита ОС от установленного ПО в Ubuntu) либо SeLinux(Centos) (требует постоянного обновления профиля при обновлении приложения https://adminvps.ru/blog/zashhita-docker-kontejnerov-s-apparmor/) (дополнительные профили в sudo apt install apparmor-profiles и в Интернете)
12) Шифруем жесткий диск с помощью LUKS (при перезагрузке требуется вводить passphrase вручную)
13) Ужесточаем доступ по SSH (вход по ключу вместо пароля и тд)
14) Используем  централизованное хранилище логов вне сервера для rsyslog, auditd


1) минимизировать область атаки
- использовать минимальный образ<br>
Для Ubuntu/Debian – ubuntu-minimal, netinstall, debootstrap.<br>
Для CentOS/RHEL – Minimal ISO, kickstart.<br>
- отключить неиспользуемые службы
- отключить неиспользуемые модули ядра
- закрыть порты (проверка на открытые порты `sudo nmap -sV -Pn <IP-security-ubnt>`)
- удалить неиспользуемые пакеты
- регулярно обновлять систему и ПО (автоматически обновляется ядро)
- следить за уязвимостями с помощью trivy (`scan_vulnerability.md`)
- настроить fail2ban для запрета брутфорса ssh (`fail2ban.md`)
- настроить firewall, настроив политики сетевого доступа (iptables, nftables, ufw, firewalld)
- можно подключить 2й фактор для подключения по ssh (google authenticator для локальных машин, OpenLDAP + privacyIDEA – управление 2FA через OpenLDAP - для бизнеса) (`2fa_google_authenticator.md`)
- проверять есть ли пароль в базе утечек через какой-либо модуль pam или ручной скрипт с https://haveibeenpwned.com/
- настроить размер history и запрет на его удаление, а также сбор логов по history в центральное хранилище логов (`session_control.md`)
- использовать auditd для контроля изменений на уровне ядра (спец правила контролирующие изменение /etc/passwd /etc/group и всего остального, что хочешь контролировать) (спроси нейросетку auditd best practies + wazuh (централизованный сбор логов ELK))
- шифровать жесткий диск с помощью LUKS
- защищай ОС от устанавливаемых программ с помощью AppArmor(Ubuntu) и SeLinux(Centos)
